<div class="max-w-3xl mx-auto">
  <h1 class="text-2xl font-semibold mb-6 text-stone-800 tracking-tight">Refinancing Analysis</h1>

  <%# Current vs New Loan Comparison %>
  <div class="grid grid-cols-2 gap-6 mb-6">
    <div class="p-5 bg-white rounded-xl border border-stone-200 shadow-sm">
      <h2 class="text-base font-semibold mb-3 text-stone-600 border-b border-stone-100 pb-2">Current Loan</h2>
      <div class="space-y-2 text-sm">
        <p><span class="text-stone-500">Balance:</span> <%= number_to_currency(@result.current_balance) %></p>
        <p><span class="text-stone-500">Interest Rate:</span> <%= @result.current_rate %>%</p>
        <p><span class="text-stone-500">Monthly P&I:</span> <%= number_to_currency(@result.current_payment) %></p>
        <p><span class="text-stone-500">Time Remaining:</span> <%= @result.years_remaining %> years</p>
      </div>
    </div>

    <div class="p-5 bg-white rounded-xl border border-stone-200 shadow-sm">
      <h2 class="text-base font-semibold mb-3 text-emerald-700 border-b border-emerald-100 pb-2">New Loan</h2>
      <div class="space-y-2 text-sm">
        <p><span class="text-stone-500">Loan Amount:</span> <%= number_to_currency(@result.current_balance) %></p>
        <p><span class="text-stone-500">Interest Rate:</span> <%= @result.new_rate %>%</p>
        <p><span class="text-stone-500">Monthly P&I:</span> <%= number_to_currency(@result.new_payment) %></p>
        <p><span class="text-stone-500">Loan Term:</span> <%= @result.new_term_years %> years</p>
      </div>
    </div>
  </div>

  <%# Savings Breakdown %>
  <div class="p-5 bg-white rounded-xl border border-stone-200 shadow-sm mb-6">
    <h2 class="text-base font-semibold mb-4 text-stone-700">Savings Breakdown</h2>

    <% if @result.monthly_savings > 0 %>
      <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
          <p class="text-stone-500 text-sm">Monthly Savings</p>
          <p class="text-2xl font-bold text-emerald-600"><%= number_to_currency(@result.monthly_savings) %></p>
        </div>
        <div>
          <p class="text-stone-500 text-sm">Annual Savings</p>
          <p class="text-2xl font-bold text-emerald-600"><%= number_to_currency(@result.annual_savings) %></p>
        </div>
      </div>

      <div class="border-t border-stone-100 pt-4 space-y-3 text-sm">
        <div class="flex justify-between">
          <span class="text-stone-600">Closing Costs:</span>
          <span class="font-semibold"><%= number_to_currency(@result.closing_costs) %></span>
        </div>
        <% if @result.used_estimate %>
          <p class="text-xs text-stone-400">
            Estimated range: <%= number_to_currency(@result.closing_costs_low) %> - <%= number_to_currency(@result.closing_costs_high) %>
          </p>
        <% end %>
        <div class="flex justify-between">
          <span class="text-stone-600">Break-Even Point:</span>
          <span class="font-semibold">
            <% if @result.break_even_years == 0 %>
              <%= @result.break_even_remaining_months %> months
            <% elsif @result.break_even_remaining_months == 0 %>
              <%= @result.break_even_years %> years
            <% else %>
              <%= @result.break_even_years %> years, <%= @result.break_even_remaining_months %> months
            <% end %>
          </span>
        </div>
        <div class="flex justify-between">
          <span class="text-stone-600">Total Interest Saved:</span>
          <span class="font-semibold text-emerald-600"><%= number_to_currency(@result.interest_savings) %></span>
        </div>
        <div class="flex justify-between border-t border-stone-100 pt-3">
          <span class="text-stone-600">Net Savings (after closing costs, over <%= @result.years_remaining %> yr):</span>
          <span class="font-bold text-lg <%= @result.net_savings > 0 ? 'text-emerald-600' : 'text-red-600' %>">
            <%= number_to_currency(@result.net_savings) %>
          </span>
        </div>
      </div>

    <% else %>
      <div class="text-center py-4">
        <p class="text-xl text-red-600 font-semibold mb-2">
          ⚠️ Monthly payment would INCREASE by <%= number_to_currency(@result.monthly_savings.abs) %>
        </p>
        <p class="text-stone-600">This refinance does NOT save money on monthly payments.</p>
        <% if @result.interest_savings > 0 %>
          <p class="mt-4 text-stone-600">
            However, if you're shortening the term, you may still save on total interest:<br>
            <span class="font-semibold">Total Interest Difference: <%= number_to_currency(@result.interest_savings) %></span>
          </p>
        <% end %>
      </div>
    <% end %>
  </div>

  <%# Recommendation %>
  <div class="p-5 rounded-xl mb-6 <%= recommendation_bg_class(@result.recommendation[:status]) %>">
    <h2 class="text-base font-semibold mb-2">
      <%= @result.recommendation[:icon] %> <%= @result.recommendation[:title] %>
    </h2>
    <p class="text-stone-700"><%= @result.recommendation[:message] %></p>
  </div>

  <%= link_to "← Back to Calculator", root_path, class: "inline-block bg-emerald-700 text-white py-3 px-6 rounded-xl font-semibold hover:bg-emerald-800 transition-colors shadow-sm" %>
</div>
